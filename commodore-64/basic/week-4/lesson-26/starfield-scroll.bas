10 REM *** PARALLAX STARFIELD SCROLLER ***
20 REM SMOOTH HARDWARE SCROLLING DEMO
30 REM
100 PRINT CHR$(147);
110 POKE 53280,0: POKE 53281,0
120 DIM ST(2,19),SS(2)
130 GOSUB 9000: REM INIT
999 REM
1000 REM *** MAIN LOOP ***
1010 GOSUB 2000: REM UPDATE STARS
1020 GOSUB 3000: REM HARDWARE SCROLL
1030 FOR T = 1 TO 5: NEXT T
1040 GOTO 1010
1999 REM
2000 REM *** UPDATE STARS ***
2010 FOR L = 0 TO 2: REM 3 LAYERS
2020 FOR I = 0 TO 19: REM 20 STARS PER LAYER
2030 ST(L,I) = ST(L,I) - SS(L)
2040 IF ST(L,I) >= 0 THEN GOTO 2080
2050 REM WRAP STAR
2060 ST(L,I) = ST(L,I) + 1000
2070 GOSUB 4000: REM REDRAW STAR
2080 NEXT I
2090 NEXT L
2100 RETURN
2999 REM
3000 REM *** HARDWARE SCROLL ***
3010 REM FAST LAYER (TOP)
3020 SC1 = SC1 - 2
3030 IF SC1 < 0 THEN SC1 = SC1 + 8: GOSUB 5000
3040 REM MEDIUM LAYER (MIDDLE)
3050 SC2 = SC2 - 1
3060 IF SC2 < 0 THEN SC2 = SC2 + 8: GOSUB 6000
3070 REM SLOW LAYER (BOTTOM)
3080 SC3 = SC3 - 1
3090 IF SC3 < 0 THEN SC3 = SC3 + 8: GOSUB 7000
3100 REM RASTER SPLIT FOR PARALLAX
3110 IF PEEK(53266) < 70 THEN GOTO 3110
3120 POKE 53270, 8 + SC1: REM TOP SCROLL
3130 IF PEEK(53266) < 140 THEN GOTO 3130
3140 POKE 53270, 8 + SC2: REM MIDDLE SCROLL
3150 IF PEEK(53266) < 210 THEN GOTO 3150
3160 POKE 53270, 8 + SC3: REM BOTTOM SCROLL
3170 RETURN
3999 REM
4000 REM *** REDRAW STAR ***
4010 REM INPUT: L (LAYER), I (STAR INDEX)
4020 X = INT(ST(L,I) / 25) AND 31
4030 Y = (L * 8) + INT(I / 2.5)
4040 CH = 46: REM PERIOD
4050 IF L = 0 THEN CH = 81: REM HEART (BRIGHT)
4060 IF L = 1 THEN CH = 122: REM DIAMOND (MEDIUM)
4070 POKE 1024+Y*40+X, CH
4080 CO = 1: REM WHITE
4090 IF L = 1 THEN CO = 15: REM LIGHT GREY
4100 IF L = 2 THEN CO = 12: REM DARK GREY
4110 POKE 55296+Y*40+X, CO
4120 RETURN
4999 REM
5000 REM *** SHIFT TOP LAYER ***
5010 FOR R = 0 TO 7
5020 FOR X = 0 TO 38
5030 POKE 1024+R*40+X, PEEK(1024+R*40+X+1)
5040 POKE 55296+R*40+X, PEEK(55296+R*40+X+1)
5050 NEXT X
5060 POKE 1024+R*40+39, 32
5070 NEXT R
5080 RETURN
5999 REM
6000 REM *** SHIFT MIDDLE LAYER ***
6010 FOR R = 8 TO 15
6020 FOR X = 0 TO 38
6030 POKE 1024+R*40+X, PEEK(1024+R*40+X+1)
6040 POKE 55296+R*40+X, PEEK(55296+R*40+X+1)
6050 NEXT X
6060 POKE 1024+R*40+39, 32
6070 NEXT R
6080 RETURN
6999 REM
7000 REM *** SHIFT BOTTOM LAYER ***
7010 FOR R = 16 TO 24
7020 FOR X = 0 TO 38
7030 POKE 1024+R*40+X, PEEK(1024+R*40+X+1)
7040 POKE 55296+R*40+X, PEEK(55296+R*40+X+1)
7050 NEXT X
7060 POKE 1024+R*40+39, 32
7070 NEXT R
7080 RETURN
8999 REM
9000 REM *** INIT ***
9010 REM CLEAR SCREEN
9020 FOR I = 0 TO 999
9030 POKE 1024+I, 32
9040 NEXT I
9050 REM SETUP STAR LAYERS
9060 SS(0) = 3: REM FAST LAYER SPEED
9070 SS(1) = 2: REM MEDIUM LAYER SPEED
9080 SS(2) = 1: REM SLOW LAYER SPEED
9090 REM INIT STAR POSITIONS
9100 FOR L = 0 TO 2
9110 FOR I = 0 TO 19
9120 ST(L,I) = INT(RND(1) * 1000)
9130 GOSUB 4000: REM DRAW STAR
9140 NEXT I
9150 NEXT L
9160 REM INIT SCROLL POSITIONS
9170 SC1 = 7: SC2 = 7: SC3 = 7
9180 RETURN
