10 REM *** PLATFORM GAME ***
20 PRINT CHR$(147);
30 POKE 53280,14: POKE 53281,6: REM SKY BLUE
40 REM VARIABLES
50 PX=100:PY=180:PVX=0:PVY=0:PF=0:PD=1
60 ONGROUND=0:CAMX=0:SCROLL=0
70 SCORE=0:LIVES=3:PT=0
80 GOSUB 9000: REM INIT LEVEL
90 GOSUB 9500: REM INIT SPRITES
999 REM
1000 REM *** MAIN LOOP ***
1010 GOSUB 2000: REM PLAYER PHYSICS
1020 GOSUB 4000: REM COLLISION
1030 GOSUB 4500: REM COLLECTABLES
1040 GOSUB 4700: REM HAZARDS
1050 GOSUB 5000: REM CAMERA
1060 GOSUB 7000: REM ANIMATION
1070 GOSUB 8000: REM UPDATE SPRITE
1080 FOR T = 1 TO 3: NEXT T
1090 GOTO 1010
1999 REM
2000 REM *** PLAYER PHYSICS ***
2010 REM GRAVITY
2020 PVY = PVY + 0.4
2030 REM HORIZONTAL MOVEMENT
2040 GOSUB 3000: REM READ JOYSTICK
2050 IF JX = -1 THEN PVX = PVX - 0.5: PD = 0
2060 IF JX = 1 THEN PVX = PVX + 0.5: PD = 1
2070 REM FRICTION
2080 PVX = PVX * 0.85
2090 REM SPEED LIMITS
2100 IF PVX > 3 THEN PVX = 3
2110 IF PVX < -3 THEN PVX = -3
2120 IF PVY > 6 THEN PVY = 6
2130 REM JUMP
2140 IF JF = 1 AND ONGROUND = 1 THEN PVY = -5: ONGROUND = 0
2150 REM APPLY VELOCITY
2160 PX = PX + PVX
2170 PY = PY + PVY
2180 RETURN
2999 REM
3000 REM *** READ JOYSTICK ***
3010 J = PEEK(56320)
3020 JX = 0: JF = 0
3030 IF J AND 4 THEN GOTO 3050
3040 JX = -1
3050 IF J AND 8 THEN GOTO 3070
3060 JX = 1
3070 IF J AND 16 THEN GOTO 3090
3080 JF = 1
3090 RETURN
3999 REM
4000 REM *** COLLISION ***
4010 CX = INT(PX / 8)
4020 CY = INT(PY / 8)
4030 REM GROUND
4040 IF CY > 22 THEN CY = 22: PY = 176: PVY = 0: ONGROUND = 1: RETURN
4050 REM PLATFORM BELOW
4060 CH = PEEK(1024 + (CY+1)*40 + CX)
4070 IF CH <> 160 THEN GOTO 4110
4080 IF PVY <= 0 THEN GOTO 4110
4090 PY = CY * 8: PVY = 0: ONGROUND = 1
4100 RETURN
4110 ONGROUND = 0
4120 REM CEILING
4130 IF CY < 1 THEN CY = 1: PY = 8: PVY = 0
4140 CH = PEEK(1024 + (CY-1)*40 + CX)
4150 IF CH <> 160 THEN GOTO 4180
4160 IF PVY >= 0 THEN GOTO 4180
4170 PY = (CY+1) * 8: PVY = 0
4180 REM WALLS
4190 IF CX < 1 THEN CX = 1: PX = 8: PVX = 0
4200 IF CX > 38 THEN CX = 38: PX = 304: PVX = 0
4210 RETURN
4499 REM
4500 REM *** COLLECTABLES ***
4510 CH = PEEK(1024 + CY*40 + CX)
4520 IF CH <> 81 THEN RETURN
4530 POKE 1024 + CY*40 + CX, 32
4540 SCORE = SCORE + 10
4550 REM SOUND
4560 POKE 54296,15
4570 POKE 54276,17
4580 POKE 54273,20
4590 POKE 54272,0
4600 POKE 54277,15
4610 POKE 54278,0
4620 POKE 54278,17
4630 FOR I = 1 TO 10: NEXT I
4640 POKE 54278,0
4650 RETURN
4699 REM
4700 REM *** HAZARDS ***
4710 CH = PEEK(1024 + CY*40 + CX)
4720 IF CH <> 87 THEN RETURN
4730 LIVES = LIVES - 1
4740 IF LIVES = 0 THEN GOTO 8500
4750 REM RESPAWN
4760 PX = 100: PY = 180
4770 PVX = 0: PVY = 0
4780 CAMX = 0
4790 RETURN
4999 REM
5000 REM *** UPDATE CAMERA ***
5010 TARGET = PX - 160
5020 IF TARGET < 0 THEN TARGET = 0
5030 IF TARGET > 1000 THEN TARGET = 1000
5040 DIFF = TARGET - CAMX
5050 CAMX = CAMX + DIFF * 0.1
5060 SCROLL = INT(CAMX) AND 7
5070 POKE 53270, 8 + SCROLL
5080 IF SCROLL = 0 THEN GOSUB 6000
5090 RETURN
5999 REM
6000 REM *** SHIFT SCREEN ***
6010 IF INT(CAMX) < 8 THEN RETURN
6020 FOR R = 0 TO 24
6030 FOR X = 0 TO 38
6040 POKE 1024+R*40+X, PEEK(1024+R*40+X+1)
6050 POKE 55296+R*40+X, PEEK(55296+R*40+X+1)
6060 NEXT X
6070 POKE 1024+R*40+39, 32
6080 NEXT R
6090 RETURN
6999 REM
7000 REM *** ANIMATE PLAYER ***
7010 REM IDLE
7020 IF ABS(PVX) < 0.2 AND ONGROUND = 1 THEN PF = 0: GOTO 7090
7030 REM JUMPING
7040 IF ONGROUND = 0 THEN PF = 4: GOTO 7090
7050 REM WALKING
7060 PT = PT + 1
7070 IF PT < 6 THEN GOTO 7090
7080 PT = 0: PF = PF + 1: IF PF > 3 THEN PF = 0
7090 REM SET SPRITE FRAME
7100 BASE = 0
7110 IF PD = 0 THEN BASE = 8
7120 POKE 2040, 64 + BASE + PF
7130 RETURN
7999 REM
8000 REM *** UPDATE SPRITE ***
8010 SX = PX - INT(CAMX)
8020 SY = PY
8030 POKE 53248, SX AND 255
8040 POKE 53249, SY
8050 HI = PEEK(53264)
8060 IF SX > 255 THEN HI = HI OR 1: GOTO 8080
8070 HI = HI AND 254
8080 POKE 53264, HI
8090 RETURN
8499 REM
8500 REM *** GAME OVER ***
8510 PRINT CHR$(147);
8520 PRINT TAB(12)"GAME OVER"
8530 PRINT
8540 PRINT TAB(10)"SCORE: ";SCORE
8550 PRINT
8560 PRINT TAB(8)"PRESS FIRE TO RETRY"
8570 J = PEEK(56320)
8580 IF J AND 16 THEN GOTO 8570
8590 RUN
8999 REM
9000 REM *** INIT LEVEL ***
9010 FOR I = 0 TO 999
9020 POKE 1024+I, 32
9030 POKE 55296+I, 6
9040 NEXT I
9050 REM GROUND
9060 FOR X = 0 TO 39
9070 POKE 1024+23*40+X, 160
9080 POKE 55296+23*40+X, 5
9090 NEXT X
9100 REM PLATFORM 1
9110 FOR X = 10 TO 20
9120 POKE 1024+18*40+X, 160
9130 POKE 55296+18*40+X, 5
9140 NEXT X
9150 REM PLATFORM 2
9160 FOR X = 25 TO 32
9170 POKE 1024+14*40+X, 160
9180 POKE 55296+14*40+X, 5
9190 NEXT X
9200 REM COINS
9210 POKE 1024+17*40+15, 81
9220 POKE 1024+13*40+28, 81
9230 POKE 1024+22*40+30, 81
9240 REM SPIKES
9250 POKE 1024+22*40+20, 87
9260 POKE 1024+22*40+21, 87
9270 RETURN
9499 REM
9500 REM *** INIT SPRITES ***
9510 FOR I = 0 TO 62
9520 READ D
9530 POKE 832+I,D
9540 NEXT I
9550 DATA 0,126,0,1,255,128,3,255,192
9560 DATA 3,255,192,7,255,224,7,231,224
9570 DATA 7,231,224,15,255,240,15,255,240
9580 DATA 7,231,224,3,231,192,1,231,128
9590 DATA 1,231,128,3,255,192,3,129,192
9600 DATA 6,0,96,6,0,96,12,0,48
9610 DATA 12,0,48,8,0,16,0,0,0
9620 POKE 2040,13
9630 POKE 53287,1
9640 POKE 53269,1
9650 RETURN
