10 REM *** 16 BOUNCING SPRITES ***
20 REM SPRITE MULTIPLEXING DEMO
30 REM
100 PRINT CHR$(147);
110 POKE 53280,0: POKE 53281,0
120 DIM SX(15),SY(15),DX(15),DY(15),SC(15)
130 GOSUB 9000: REM INIT
999 REM
1000 REM *** MAIN LOOP ***
1010 GOSUB 2000: REM UPDATE POSITIONS
1020 GOSUB 3000: REM MULTIPLEX DISPLAY
1030 GOTO 1010
1999 REM
2000 REM *** UPDATE SPRITE POSITIONS ***
2010 FOR I = 0 TO 15
2020 SX(I) = SX(I) + DX(I)
2030 SY(I) = SY(I) + DY(I)
2040 REM BOUNCE OFF EDGES
2050 IF SX(I) < 24 THEN SX(I) = 24: DX(I) = -DX(I)
2060 IF SX(I) > 320 THEN SX(I) = 320: DX(I) = -DX(I)
2070 IF SY(I) < 50 THEN SY(I) = 50: DY(I) = -DY(I)
2080 IF SY(I) > 229 THEN SY(I) = 229: DY(I) = -DY(I)
2090 NEXT I
2100 RETURN
2999 REM
3000 REM *** MULTIPLEX SPRITES ***
3010 REM WAIT FOR TOP OF SCREEN
3020 IF PEEK(53266) < 45 THEN GOTO 3020
3030 REM SHOW SPRITES 0-7 (TOP HALF)
3040 FOR I = 0 TO 7
3050 BI = I: SI = I
3060 GOSUB 4000: REM UPDATE SPRITE
3070 NEXT I
3080 REM WAIT FOR BOTTOM OF SCREEN
3090 IF PEEK(53266) < 140 THEN GOTO 3090
3100 REM SHOW SPRITES 8-15 (BOTTOM HALF)
3110 FOR I = 0 TO 7
3120 BI = I: SI = I + 8
3130 GOSUB 4000: REM UPDATE SPRITE
3140 NEXT I
3150 RETURN
3999 REM
4000 REM *** UPDATE HARDWARE SPRITE ***
4010 REM INPUT: BI (HARDWARE 0-7), SI (SOFTWARE 0-15)
4020 POKE 53248+BI*2, SX(SI) AND 255
4030 POKE 53249+BI*2, SY(SI)
4040 POKE 53287+BI, SC(SI)
4050 REM HANDLE X > 255
4060 HI = PEEK(53264)
4070 IF SX(SI) > 255 THEN HI = HI OR (2^BI): GOTO 4090
4080 HI = HI AND (255-(2^BI))
4090 POKE 53264, HI
4100 RETURN
8999 REM
9000 REM *** INIT ***
9010 REM SPRITE DATA
9020 FOR I = 0 TO 62
9030 READ D
9040 POKE 832+I,D
9050 NEXT I
9060 DATA 0,126,0,3,255,192,7,255,224
9070 DATA 15,255,240,31,255,248,63,255,252
9080 DATA 63,255,252,127,255,254,127,255,254
9090 DATA 127,255,254,127,255,254,127,255,254
9100 DATA 63,255,252,63,255,252,31,255,248
9110 DATA 15,255,240,7,255,224,3,255,192
9120 DATA 0,126,0,0,0,0
9130 REM SETUP HARDWARE SPRITES
9140 FOR I = 0 TO 7
9150 POKE 2040+I,13: REM POINTER
9160 NEXT I
9170 POKE 53269,255: REM ENABLE ALL 8
9180 REM INIT 16 SOFTWARE SPRITES
9190 FOR I = 0 TO 15
9200 SX(I) = 50 + RND(1) * 250
9210 SY(I) = 60 + RND(1) * 160
9220 DX(I) = INT(RND(1) * 3) + 1
9230 DY(I) = INT(RND(1) * 3) + 1
9240 IF RND(1) > 0.5 THEN DX(I) = -DX(I)
9250 IF RND(1) > 0.5 THEN DY(I) = -DY(I)
9260 SC(I) = INT(RND(1) * 15) + 1
9270 NEXT I
9280 RETURN
