10 REM *** BOUNCING BALLS - LESSON 19 ***
20 REM WOW MOMENT: 8 SPRITES BOUNCING
30 DIM SX(7), SY(7), DX(7), DY(7)
40 GOSUB 9000: REM SETUP SPRITES
50 GOSUB 1000: REM INIT POSITIONS
60 GOSUB 2000: REM MAIN LOOP
70 END
1000 REM *** INIT SPRITE POSITIONS ***
1010 FOR I = 0 TO 7
1020 SX(I) = 24 + I * 30
1030 SY(I) = 50 + I * 10
1040 DX(I) = 1 + INT(RND(1) * 3)
1050 DY(I) = 1 + INT(RND(1) * 3)
1060 IF RND(1) > 0.5 THEN DX(I) = -DX(I)
1070 IF RND(1) > 0.5 THEN DY(I) = -DY(I)
1080 NEXT I
1090 RETURN
2000 REM *** MAIN LOOP ***
2010 FOR I = 0 TO 7
2020 REM UPDATE POSITION
2030 SX(I) = SX(I) + DX(I)
2040 SY(I) = SY(I) + DY(I)
2050 REM BOUNCE OFF EDGES
2060 IF SX(I) < 24 THEN DX(I) = -DX(I): SX(I) = 24
2070 IF SX(I) > 320 THEN DX(I) = -DX(I): SX(I) = 320
2080 IF SY(I) < 50 THEN DY(I) = -DY(I): SY(I) = 50
2090 IF SY(I) > 229 THEN DY(I) = -DY(I): SY(I) = 229
2100 REM SET POSITION
2110 XL = SX(I) AND 255
2120 POKE 53248 + I * 2, XL
2130 POKE 53249 + I * 2, SY(I)
2140 NEXT I
2150 REM UPDATE X MSB REGISTER
2160 XM = 0
2170 FOR I = 0 TO 7
2180 IF SX(I) > 255 THEN XM = XM + 2^I
2190 NEXT I
2200 POKE 53264, XM
2210 FOR D = 1 TO 5: NEXT D
2220 GOTO 2010
9000 REM *** SETUP SPRITES ***
9010 REM CREATE BALL SPRITE AT 832
9020 FOR I = 832 TO 894: POKE I, 0: NEXT I
9030 AD = 832 + 7 * 3
9040 RESTORE 9100
9050 FOR R = 0 TO 6
9060 READ B1, B2, B3
9070 POKE AD + R * 3, B1
9080 POKE AD + R * 3 + 1, B2
9090 POKE AD + R * 3 + 2, B3
9095 NEXT R
9096 REM BALL DATA
9100 DATA 1,128,0,3,192,0,7,224,0
9110 DATA 7,224,0,7,224,0,3,192,0,1,128,0
9120 REM ENABLE ALL 8 SPRITES
9130 FOR I = 0 TO 7
9140 POKE 2040 + I, 13: REM ALL USE SAME SHAPE
9150 POKE 53287 + I, I + 1: REM DIFFERENT COLORS
9160 NEXT I
9170 POKE 53269, 255: REM ENABLE ALL (255 = 11111111)
9180 RETURN
