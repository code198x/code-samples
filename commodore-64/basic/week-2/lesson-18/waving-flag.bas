10 REM *** WAVING FLAG ANIMATION - LESSON 18 ***
20 REM WOW MOMENT: RIPPLING FLAG EFFECT
30 GOSUB 9000: REM SETUP CHARSET
40 REM DEFINE 4 WAVE FRAMES
50 FOR FR = 1 TO 4
60   AD = 12288 + (FR * 8)
70   FOR R = 0 TO 7
80     BY = 0
90     OF = (R + FR) AND 3
100    IF OF = 0 THEN BY = 255
110    IF OF = 1 THEN BY = 127
120    IF OF = 2 THEN BY = 63
130    IF OF = 3 THEN BY = 31
140    POKE AD + R, BY
150  NEXT R
160 NEXT FR
170 REM CREATE FLAG FIELD
180 PRINT CHR$(147)
190 FOR R = 5 TO 15
200  FOR C = 10 TO 30
210   POS = R * 40 + C
220   POKE 1024 + POS, 1
230   CO = (R + C) AND 3 + 1
240   POKE 55296 + POS, CO
250  NEXT C
260 NEXT R
270 REM ANIMATE WAVE
280 FOR CY = 1 TO 100
290  FOR R = 5 TO 15
300   FOR C = 10 TO 30
310    POS = R * 40 + C
320    FR = ((C + CY) AND 3) + 1
330    POKE 1024 + POS, FR
340   NEXT C
350  NEXT R
360  FOR D = 1 TO 20: NEXT D
370 NEXT CY
380 END
9000 REM *** SETUP CHARSET ***
9010 FOR I = 0 TO 2047
9020   POKE 12288 + I, PEEK(53248 + I)
9030 NEXT I
9040 POKE 53272, PEEK(53272) OR 14
9050 RETURN
