NEW
10 REM *** PERFORMANCE THRESHOLD TEST ***
20 PRINT CHR$(147);"FRAME BUDGET MONITOR"
30 TARGET=3:REM 3 jiffies (~1/20th second)
40 DIM FEATURE$(3),ACTIVE(3)
50 DATA "STARFIELD",1,"SPARKS",1,"WAVEFORM",1
60 FOR I=0 TO 2:READ FEATURE$(I):READ ACTIVE(I):NEXT
70 PRINT "PRESS SPACE TO RUN, RETURN TO EXIT"
80 GET K$:IF K$=CHR$(13) THEN END
90 IF K$<>" " THEN 80
100 PRINT CHR$(147)
110 TI$="000000"
120 GOSUB 400:REM run frame
130 FRAME=TI
140 PRINT "FRAME:";FRAME;" jiffies"
150 IF FRAME>TARGET THEN GOSUB 500
160 GOSUB 600
170 IF NOTREADY=3 THEN PRINT "ALL OPTIONAL FEATURES DISABLED" :END
180 GOTO 110

400 REM *** SIMULATED WORKLOAD ***
410 IF ACTIVE(0) THEN FOR I=0 TO 150:NEXT
420 IF ACTIVE(1) THEN FOR I=0 TO 50:Z=SIN(I):NEXT
430 IF ACTIVE(2) THEN FOR I=0 TO 20:POKE 54276,33:POKE 54296,0:NEXT
440 RETURN

500 REM *** DEGRADATION MANAGER ***
510 FOR I=2 TO 0 STEP -1
520 IF ACTIVE(I) THEN ACTIVE(I)=0:PRINT "DISABLING ";FEATURE$(I):RETURN
530 NEXT I
540 RETURN

600 REM *** STATUS HUD ***
610 PRINT "ACTIVE FEATURES:";
620 NOTREADY=0
630 FOR I=0 TO 2
640 IF ACTIVE(I) THEN PRINT FEATURE$(I);" "; ELSE NOTREADY=NOTREADY+1
650 NEXT I
660 PRINT
670 RETURN
