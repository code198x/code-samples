REM *** LESSON 63: RHYTHM/MUSIC GAME ***
REM WOW Moment
NEW
10 REM *** RHYTHM MASTER ***
20 PRINT CHR$(147)
30 POKE 53280,11:POKE 53281,12
40 PRINT
50 PRINT "  *** RHYTHM MASTER ***"
60 PRINT
70 PRINT "  4 NOTES: W A S D"
80 PRINT "  HIT WHEN NOTE REACHES >"
90 PRINT "  BUILD COMBOS FOR BONUS!"
100 PRINT
110 PRINT "  PRESS FIRE TO START"
120 GET K$:IF K$="" THEN GOTO 120
130 REM *** INIT ***
140 SC=0:CB=0:MX=0
150 DIM NT$(20):DIM NP(20):DIM NH(20)
160 REM *** GENERATE SONG ***
170 FOR I=1 TO 20
180 R=INT(RND(1)*4)+1
190 IF R=1 THEN NT$(I)="W"
200 IF R=2 THEN NT$(I)="A"
210 IF R=3 THEN NT$(I)="S"
220 IF R=4 THEN NT$(I)="D"
230 NP(I)=0:NH(I)=0
240 NEXT I
250 N=1:TM=0
260 REM *** MAIN LOOP ***
270 PRINT CHR$(19)
280 PRINT "SCORE:";SC;" COMBO:";CB;" MAX:";MX
290 PRINT
300 PRINT "LANE W    A    S    D"
310 PRINT
320 REM *** DRAW LANES ***
330 FOR Y=1 TO 15
340 FOR L=1 TO 4
350 C$=" "
360 REM *** DRAW NOTES ***
370 FOR I=1 TO 20
380 IF NH(I)=0 AND NP(I)=Y AND ((NT$(I)="W" AND L=1) OR (NT$(I)="A" AND L=2) OR (NT$(I)="S" AND L=3) OR (NT$(I)="D" AND L=4)) THEN C$="*"
390 NEXT I
400 REM *** HIT ZONE ***
410 IF Y=13 THEN C$=">"
420 PRINT C$;"   ";
430 NEXT L
440 PRINT
450 NEXT Y
460 PRINT
470 PRINT "NOTE ";N;"/20"
480 REM *** INPUT ***
490 GET K$
500 REM *** CHECK HIT ***
510 IF K$<>"" AND (K$="W" OR K$="A" OR K$="S" OR K$="D") THEN GOSUB 1000
520 REM *** MOVE NOTES ***
530 TM=TM+1
540 IF TM>3 THEN TM=0:FOR I=1 TO 20:IF NH(I)=0 THEN NP(I)=NP(I)+1
550 NEXT I
560 REM *** SPAWN NEXT NOTE ***
570 IF N<=20 AND NP(N)=0 THEN NP(N)=1
580 REM *** MISS CHECK ***
590 IF NP(N)>14 AND NH(N)=0 THEN NH(N)=2:CB=0:PRINT "MISS!":FOR I=1 TO 500:NEXT I
600 REM *** ADVANCE ***
610 IF NH(N)>0 THEN N=N+1
620 IF N>20 THEN GOSUB 2000
630 FOR I=1 TO 30:NEXT I
640 GOTO 270
650 REM
1000 REM *** HIT DETECTION ***
1010 IF K$<>NT$(N) THEN PRINT "WRONG NOTE!":CB=0:RETURN
1020 D=ABS(NP(N)-13)
1030 IF D=0 THEN JG$="PERFECT!":PT=50:CB=CB+1:POKE 53280,5
1040 IF D=1 THEN JG$="GOOD!":PT=30:CB=CB+1:POKE 53280,7
1050 IF D>=2 THEN JG$="OK":PT=10:CB=CB+1:POKE 53280,1
1060 IF D>3 THEN JG$="MISS!":PT=0:CB=0:POKE 53280,2
1070 NH(N)=1
1080 BO=1+INT(CB/5)
1090 SC=SC+(PT*BO)
1100 IF CB>MX THEN MX=CB
1110 PRINT JG$;" +";PT*BO;" (x";BO;")"
1120 FOR I=1 TO 300:NEXT I
1130 POKE 53280,11
1140 RETURN
1150 REM
2000 REM *** SONG COMPLETE ***
2010 PRINT CHR$(147)
2020 POKE 53280,5:POKE 53281,13
2030 PRINT
2040 PRINT "  *** SONG COMPLETE! ***"
2050 PRINT
2060 PRINT "  FINAL SCORE: ";SC
2070 PRINT "  MAX COMBO: ";MX
2080 PRINT
2090 RK=INT(SC/100)
2100 IF RK>=10 THEN PRINT "  RANK: S (MASTER!)"
2110 IF RK>=7 AND RK<10 THEN PRINT "  RANK: A (EXCELLENT!)"
2120 IF RK>=4 AND RK<7 THEN PRINT "  RANK: B (GOOD!)"
2130 IF RK<4 THEN PRINT "  RANK: C (PRACTICE!)"
2140 PRINT
2150 PRINT "  PRESS FIRE TO RETRY"
2160 GET K$:IF K$="" THEN GOTO 2160
2170 GOTO 130