NEW
10 REM *** POWER-UP LOOP ***
20 PRINT CHR$(147);"WASD MOVE  SPACE QUIT"
30 FOR I=832 TO 895:POKE I,0:NEXT I
40 POKE 2040,13:POKE 2041,16
50 POKE 53269,3:POKE 53287,12:POKE 53288,7
60 PX=160:PY=200:SPD=3
70 PUX=120:PUY=120:PU_STATE=0:SPAWN=180:BUFF=0
80 R=RND(-TI)
90 GET K$:IF K$=" " THEN END
100 IF K$="A" THEN PX=PX-SPD
110 IF K$="D" THEN PX=PX+SPD
120 IF K$="W" THEN PY=PY-SPD
130 IF K$="S" THEN PY=PY+SPD
140 IF PX<24 THEN PX=24
150 IF PX>320 THEN PX=320
160 IF PY<80 THEN PY=80
170 IF PY>233 THEN PY=233
180 POKE 53248,PX:POKE 53249,PY
190 IF PU_STATE=0 THEN GOSUB 400
200 IF PU_STATE=1 THEN GOSUB 430
210 IF PU_STATE=2 THEN GOSUB 520
220 COL=PEEK(53279)
230 IF PU_STATE=1 AND (COL AND 1) AND (COL AND 2) THEN GOSUB 560
240 PRINT CHR$(19);"BUFF:";:IF PU_STATE=2 THEN PRINT "SPEED"; ELSE PRINT "--   ";
250 PRINT TAB(18);"SPAWN:";SPAWN;"   ";
260 PRINT TAB(32);"SPEED:";SPD;"   "
270 FOR D=1 TO 3:NEXT D
280 GOTO 90
400 REM *** COUNTDOWN TO SPAWN ***
410 SPAWN=SPAWN-1:IF SPAWN<=0 THEN GOSUB 440
420 RETURN
430 REM *** DRAW POWER-UP ***
440 POKE 53250,PUX:POKE 53251,PUY
450 RETURN
460 REM *** CREATE POWER-UP ***
470 PUX=40+INT(RND(1)*240)
480 PUY=70+INT(RND(1)*120)
490 POKE 53288,10:PU_STATE=1:SPAWN=0
500 RETURN
520 REM *** BUFF ACTIVE ***
530 BUFF=BUFF-1
540 IF BUFF<=0 THEN GOSUB 580
550 RETURN
560 REM *** APPLY BUFF ***
570 PU_STATE=2:BUFF=180:SPAWN=240:SPD=6
580 POKE 53288,14:POKE 53251,0
590 RETURN
580 REM *** CLEAR BUFF ***
590 PU_STATE=0:SPD=3:POKE 53288,7
600 RETURN
