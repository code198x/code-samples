10 REM *** COSMIC CLASH ***
20 GOSUB 9000:REM sprite setup
30 DIM ENX(1),ENY(1),EDX(1),EMODE(1),EBURST(1),ALIVE(1),RESP(1),BDROP(1),BX(1),BY(1),BSTATE(1)
40 DIM NAME$(5),HS(5)
50 DATA "ACE",600,"JAX",480,"MIN",360,"SID",200,"DOC",120
60 FOR I=1 TO 5:READ NAME$(I):READ HS(I):NEXT
70 STATE=0:LAST=-1:KEY$=""
80 LIVES=3:SCORE=0:LEVEL=1:TARGET=150:GAMEINIT=0:HIINSERT=0
90 TI$="000000"
100 GET K$:IF K$<>"" THEN KEY$=K$
110 IF STATE<>LAST THEN GOSUB 500
120 ON STATE+1 GOSUB 600,700,800
130 LAST=STATE:KEY$=""
140 GOTO 100
500 REM *** STATE DRAWER ***
510 IF STATE=0 THEN GOSUB 2000
520 IF STATE=1 THEN GOSUB 2100
530 IF STATE=2 THEN GOSUB 2200
540 RETURN
600 REM *** TITLE STATE ***
610 IF KEY$=" " THEN STATE=1:GAMEINIT=0
620 IF KEY$="Q" THEN END
630 RETURN
700 REM *** PLAY STATE ***
710 IF GAMEINIT=0 THEN GOSUB 3000:GAMEINIT=1
720 GOSUB 3100
730 GOSUB 3200
740 GOSUB 3300
750 GOSUB 3420
760 GOSUB 3520
770 GOSUB 3600
780 RETURN
800 REM *** GAME OVER STATE ***
810 IF HIINSERT=0 THEN GOSUB 4000
820 IF KEY$="R" THEN STATE=0:HIINSERT=0
830 IF KEY$="Q" THEN END
840 RETURN
2000 PRINT CHR$(147)
2010 PRINT "COSMIC CLASH"
2020 PRINT
2030 PRINT "SPACE = START  Q = QUIT"
2040 PRINT "A / D = MOVE  P = PAUSE"
2050 PRINT
2060 PRINT "SURVIVE WAVES OF DRONES AND BOMBS"
2070 RETURN
2100 PRINT CHR$(147)
2110 PRINT "LAUNCHING..."
2120 RETURN
2200 PRINT CHR$(147)
2210 PRINT "MISSION FAILED"
2220 PRINT "YOUR SCORE:";SCORE
2230 PRINT
2240 PRINT "R = RESTART   Q = QUIT"
2250 PRINT
2260 GOSUB 4100
2270 RETURN
3000 REM *** RESET GAME VARIABLES ***
3010 PRINT CHR$(147)
3020 LIVES=3:SCORE=0:LEVEL=1:TARGET=150:SHOT=0:COOLDOWN=0
3030 PU_STATE=0:PU_TIMER=300:BUFF=0:SPD=4
3040 PX=160:PY=210:POKE 53248,PX:POKE 53249,PY
3050 FOR I=0 TO 1
3060 ENX(I)=40+I*180:ENY(I)=70+I*60
3070 EDX(I)=2:EMODE(I)=0:EBURST(I)=0:ALIVE(I)=1:RESP(I)=0
3080 BDROP(I)=80:BY(I)=0:BSTATE(I)=0
3090 NEXT I
3100 POKE 53250,0:POKE 53251,0:POKE 53254,0:POKE 53255,0:POKE 53256,0:POKE 53257,0
3110 RETURN
3100 REM *** INPUT ***
3110 IF KEY$="A" THEN PX=PX-SPD
3120 IF KEY$="D" THEN PX=PX+SPD
3130 IF PX<24 THEN PX=24
3140 IF PX>320 THEN PX=320
3150 POKE 53248,PX:POKE 53249,PY
3160 IF KEY$="P" THEN STATE=0
3170 IF KEY$=" " AND SHOT=0 AND COOLDOWN=0 THEN GOSUB 3700
3180 RETURN
3200 REM *** PLAYER SHOT ***
3210 IF SHOT=1 THEN SHY=SHY-7:POKE 53250,SHX:POKE 53251,SHY
3220 IF SHOT=1 AND SHY<48 THEN SHOT=0:COOLDOWN=10:POKE 53251,0
3230 IF COOLDOWN>0 THEN COOLDOWN=COOLDOWN-1
3240 RETURN
3300 REM *** ENEMIES ***
3310 FOR I=0 TO 1
3320 IF ALIVE(I)=0 THEN RESP(I)=RESP(I)-1:IF RESP(I)<=0 THEN GOSUB 3800:GOTO 3390
3330 DIST=ABS(PX-ENX(I))+ABS(PY-ENY(I))
3340 IF EMODE(I)=0 AND DIST<160 AND RND(1)<.25 THEN EMODE(I)=1:EBURST(I)=60
3350 IF EMODE(I)=1 THEN EBURST(I)=EBURST(I)-1:IF EBURST(I)<=0 OR DIST>220 THEN EMODE(I)=0
3360 IF EMODE(I)=0 THEN IF RND(1)<.04 THEN GOSUB 3900
3370 IF EMODE(I)=1 THEN GOSUB 3950
3380 ENX(I)=ENX(I)+EDX(I)
3385 IF ENX(I)<40 THEN ENX(I)=40:EDX(I)=-EDX(I)
3386 IF ENX(I)>300 THEN ENX(I)=300:EDX(I)=-EDX(I)
3390 POKE 53252+I*2,ENX(I):POKE 53253+I*2,ENY(I)
3400 NEXT I
3410 RETURN
3420 REM *** BOMBS ***
3410 FOR I=0 TO 1
3420 IF BSTATE(I)=0 THEN BDROP(I)=BDROP(I)-1:IF BDROP(I)<=0 AND ALIVE(I)=1 THEN BSTATE(I)=1:BDROP(I)=80-LEVEL*6:IF BDROP(I)<20 THEN BDROP(I)=20:BX(I)=ENX(I):BY(I)=ENY(I)+18:POKE 53254+I*2,BX(I):POKE 53255+I*2,BY(I)
3430 IF BSTATE(I)=1 THEN BY(I)=BY(I)+4+LEVEL:POKE 53254+I*2,BX(I):POKE 53255+I*2,BY(I)
3440 IF BSTATE(I)=1 AND BY(I)>240 THEN BSTATE(I)=0:POKE 53255+I*2,0:SCORE=SCORE+5
3450 NEXT I
3460 RETURN
3520 REM *** POWER-UP ***
3520 IF PU_STATE=0 THEN PU_TIMER=PU_TIMER-1:IF PU_TIMER<=0 THEN GOSUB 4200
3530 IF PU_STATE=1 THEN POKE 53256,PUX:POKE 53257,PUY
3540 IF PU_STATE=2 THEN BUFF=BUFF-1:IF BUFF<=0 THEN GOSUB 4300
3550 RETURN
3600 REM *** COLLISIONS & HUD ***
3610 COL=PEEK(53279)
3620 IF SHOT AND (COL AND 2) AND (COL AND 4) THEN GOSUB 4400
3630 IF SHOT AND (COL AND 2) AND (COL AND 8) THEN GOSUB 4410
3640 IF (COL AND 1) AND (COL AND 16) THEN GOSUB 4500
3650 IF (COL AND 1) AND (COL AND 32) THEN GOSUB 4510
3660 IF PU_STATE=1 AND (COL AND 1) AND (COL AND 64) THEN GOSUB 4600
3670 IF SCORE>=TARGET THEN GOSUB 4700
3680 PRINT CHR$(19);"LV:";LEVEL;" SC:";SCORE;" LIVES:";LIVES;" NEXT:";TARGET-SCORE;"   "
3690 IF LIVES<0 THEN STATE=2
3700 RETURN
3700 REM *** FIRE SHOT ***
3710 SHOT=1:SHX=PX:SHY=PY-18:POKE 53250,SHX:POKE 53251,SHY
3720 RETURN
3800 REM *** RESPAWN ENEMY I ***
3810 ENX(I)=40+INT(RND(1)*240)
3820 ENY(I)=60+I*70
3830 EDX(I)=2+SGN(RND(1)-.5)
3840 ALIVE(I)=1:EMODE(I)=0:EBURST(I)=0:BDROP(I)=60+INT(RND(1)*40)
3850 RETURN
3900 REM *** PATROL TURN ***
3910 IF RND(1)<.5 THEN EDX(I)=-EDX(I)
3920 RETURN
3950 REM *** CHASE ***
3960 IF PX>ENX(I) THEN EDX(I)=ABS(EDX(I))
3970 IF PX<ENX(I) THEN EDX(I)=-ABS(EDX(I))
3980 RETURN
4000 REM *** HIGH SCORE INSERT ***
4010 IF HIINSERT=1 THEN RETURN
4020 INPUT "INITIALS";N$
4030 N$=LEFT$(N$,3)
4040 POS=0
4050 FOR I=1 TO 5:IF SCORE>HS(I) AND POS=0 THEN POS=I
4060 NEXT I
4070 IF POS=0 THEN HIINSERT=1:RETURN
4080 FOR J=5 TO POS+1 STEP -1
4090 HS(J)=HS(J-1):NAME$(J)=NAME$(J-1)
4100 NEXT J
4110 HS(POS)=SCORE:NAME$(POS)=N$
4120 HIINSERT=1
4130 RETURN
4100 PRINT "HIGH SCORES"
4110 FOR I=1 TO 5:PRINT NAME$(I);TAB(10);HS(I):NEXT I
4120 RETURN
4200 REM *** SPAWN POWER-UP ***
4210 PUX=40+INT(RND(1)*240)
4220 PUY=90+INT(RND(1)*100)
4230 PU_STATE=1:PU_TIMER=480
4240 POKE 53294,1
4250 RETURN
4300 REM *** POWER-UP END ***
4310 PU_STATE=0:SPD=4:POKE 53294,0
4320 RETURN
4400 REM *** ENEMY 0 HIT ***
4410 SHOT=0:POKE 53251,0:COOLDOWN=5:SCORE=SCORE+30
4420 ALIVE(0)=0:RESP(0)=90
4430 IF PU_STATE=0 AND RND(1)<.25 THEN PU_TIMER=30
4440 RETURN
4450 REM *** ENEMY 1 HIT ***
4460 SHOT=0:POKE 53251,0:COOLDOWN=5:SCORE=SCORE+30
4470 ALIVE(1)=0:RESP(1)=90
4480 IF PU_STATE=0 AND RND(1)<.25 THEN PU_TIMER=30
4490 RETURN
4500 REM *** PLAYER HIT BY BOMB 0 ***
4510 BSTATE(0)=0:POKE 53255,0:LIVES=LIVES-1:IF LIVES<0 THEN LIVES=-1
4520 RETURN
4530 REM *** PLAYER HIT BY BOMB 1 ***
4540 BSTATE(1)=0:POKE 53257,0:LIVES=LIVES-1:IF LIVES<0 THEN LIVES=-1
4550 RETURN
4600 REM *** POWER-UP PICKED ***
4610 SCORE=SCORE+25:PU_STATE=2:BUFF=240:SPD=6:PU_TIMER=600:POKE 53294,0:POKE 53257,0
4620 RETURN
4700 REM *** LEVEL UP ***
4710 LEVEL=LEVEL+1:TARGET=TARGET+150
4720 TEMP=SGN(EDX(0)):IF TEMP=0 THEN TEMP=1
4730 EDX(0)=TEMP* (ABS(EDX(0))+1):IF ABS(EDX(0))>6 THEN EDX(0)=TEMP*6
4740 TEMP=SGN(EDX(1)):IF TEMP=0 THEN TEMP=1
4750 EDX(1)=TEMP*(ABS(EDX(1))+1):IF ABS(EDX(1))>6 THEN EDX(1)=TEMP*6
4760 FOR I=0 TO 1:BDROP(I)=BDROP(I)-10:IF BDROP(I)<20 THEN BDROP(I)=20:NEXT I
4770 PRINT CHR$(147);"LEVEL";LEVEL;"! SPEED UP";:FOR PA=1 TO 200:NEXT PA:PRINT CHR$(147)
4780 RETURN
4800 REM *** UNUSED ***
4810 RETURN
9000 REM *** SPRITES ***
9010 FOR I=832 TO 959:POKE I,0:NEXT I
9020 POKE 2040,13:POKE 2041,14:POKE 2042,15:POKE 2043,15:POKE 2044,14:POKE 2045,14:POKE 2046,16
9030 POKE 53269,127
9040 POKE 53287,12:POKE 53288,1:POKE 53289,3:POKE 53290,10:POKE 53291,8:POKE 53292,8:POKE 53293,5:POKE 53294,0
9050 RETURN
