10 REM *** BREAKPOINT HANDLER ***
20 ON ERROR GOTO 900
30 GOSUB 100
40 GOSUB 200
50 GOSUB 300
60 PRINT "ALL TESTS COMPLETE"
70 END

100 REM *** DATA LOADER WITH SAFETY ***
110 PRINT "LOADING LEVEL DATA..."
120 RESTORE 1000
130 READ ID
140 IF ID=0 THEN PRINT "NO MORE LEVELS." : RETURN
150 READ NAME$:PRINT "LEVEL:";ID;NAME$
160 GOSUB 400
170 GOTO 130

200 REM *** MEMORY PRESSURE TEST ***
210 PRINT "ALLOCATING SPRITE BUFFERS..."
220 BYTES=3000
230 IF FRE(0)<BYTES THEN PRINT "MEMORY LOW - SKIPPING ANIMATION" : RETURN
240 DIM SPRITE$(BYTES)
250 PRINT "SPRITE BUFFER LOADED"
260 RETURN

300 REM *** CONTROLLER EDGE CASE ***
310 PRINT "READING JOYSTICK..."
320 V=PEEK(56320)
330 IF V=255 THEN PRINT "NO JOYSTICK DETECTED" : RETURN
340 PRINT "JOYSTICK VALUE:";V
350 RETURN

400 REM *** SAFE DATA READ ***
410 FOR I=1 TO 3
420 READ TOKEN$
430 IF TOKEN$="END" THEN PRINT "WARN: LEVEL DATA SHORT" : RETURN
440 PRINT "  TOKEN:";TOKEN$
450 NEXT I
460 RETURN

900 REM *** ERROR HANDLER ***
910 PRINT CHR$(147);"
*** BASIC CAUGHT AN ERROR ***"
920 PRINT "ERR";ERR;" AT LINE";ERL
930 PRINT "FRE:";FRE(0)
940 RESUME NEXT

1000 DATA 1,"CAVERN",KEY,SWORD,GEM
1010 DATA 2,"MINE",CART,LAMP,END
1020 DATA 0,"END"
