10 REM *** RENDER SPEED TEST ***
20 GOSUB 900
30 PRINT CHR$(147);"RENDER SPEED LAB"
40 PRINT "1 = Original renderer"
50 PRINT "2 = Table-driven renderer"
60 PRINT "3 = Unrolled renderer"
70 PRINT "4 = Compare all"
80 INPUT "CHOICE";C
90 IF C=1 THEN GOSUB 1000
100 IF C=2 THEN GOSUB 2000
110 IF C=3 THEN GOSUB 3000
120 IF C=4 THEN GOSUB 4000
130 IF C<>4 THEN PRINT :PRINT "PRESS RETURN";:INPUT A$:PRINT CHR$(147)
140 IF C<>4 THEN GOTO 30
150 END

900 REM *** PREP WORK ***
910 DIM TILE$(3),ROW$(8)
920 TILE$(0)=" ":TILE$(1)="#":TILE$(2)="+":TILE$(3)="."
930 DATA 0,0,0,1,1,1,2,2
940 FOR I=0 TO 7:READ ROW(I):NEXT I
950 RETURN

1000 REM *** ORIGINAL VERSION ***
1010 TI$="000000"
1020 FOR Y=0 TO 7
1030 FOR X=0 TO 39
1040 T=ROW(Y)
1050 IF T=0 THEN TILE$=" "
1060 IF T=1 THEN TILE$="#"
1070 IF T=2 THEN TILE$="+"
1080 IF T=3 THEN TILE$="."
1090 POKE 1024+Y*40+X,ASC(TILE$)
1100 NEXT X
1110 NEXT Y
1120 T1=TI
1130 PRINT "ORIGINAL:";T1;" jiffies"
1140 RETURN

2000 REM *** TABLE-DRIVEN VERSION ***
2010 TI$="000000"
2020 FOR Y=0 TO 7
2030 BASE=1024+Y*40
2040 T=ROW(Y)
2050 TILECODE=ASC(TILE$(T))
2060 FOR X=0 TO 39
2070 POKE BASE+X,TILECODE
2080 NEXT X
2090 NEXT Y
2100 T2=TI
2110 PRINT "TABLE:";T2;" jiffies"
2120 RETURN

3000 REM *** UNROLLED VERSION ***
3010 TI$="000000"
3020 FOR Y=0 TO 7
3030 BASE=1024+Y*40
3040 CODE=ASC(TILE$(ROW(Y)))
3050 POKE BASE, CODE:POKE BASE+1,CODE:POKE BASE+2,CODE:POKE BASE+3,CODE
3060 POKE BASE+4, CODE:POKE BASE+5,CODE:POKE BASE+6,CODE:POKE BASE+7,CODE
3070 POKE BASE+8, CODE:POKE BASE+9,CODE:POKE BASE+10,CODE:POKE BASE+11,CODE
3080 POKE BASE+12, CODE:POKE BASE+13,CODE:POKE BASE+14,CODE:POKE BASE+15,CODE
3090 POKE BASE+16, CODE:POKE BASE+17,CODE:POKE BASE+18,CODE:POKE BASE+19,CODE
3100 POKE BASE+20, CODE:POKE BASE+21,CODE:POKE BASE+22,CODE:POKE BASE+23,CODE
3110 POKE BASE+24, CODE:POKE BASE+25,CODE:POKE BASE+26,CODE:POKE BASE+27,CODE
3120 POKE BASE+28, CODE:POKE BASE+29,CODE:POKE BASE+30,CODE:POKE BASE+31,CODE
3130 POKE BASE+32, CODE:POKE BASE+33,CODE:POKE BASE+34,CODE:POKE BASE+35,CODE
3140 POKE BASE+36, CODE:POKE BASE+37,CODE:POKE BASE+38,CODE:POKE BASE+39,CODE
3150 NEXT Y
3160 T3=TI
3170 PRINT "UNROLLED:";T3;" jiffies"
3180 RETURN

4000 REM *** COMPARE ALL ***
4010 PRINT CHR$(147)
4020 GOSUB 1000
4030 GOSUB 2000
4040 GOSUB 3000
4050 SPEED=T1/T2
4060 SPEED2=T1/T3
4070 PRINT
4080 PRINT "TABLE SPEED-UP:";INT(SPEED*10)/10;"x"
4090 PRINT "UNROLLED SPEED-UP:";INT(SPEED2*10)/10;"x"
4100 RETURN
